'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; }();

var _crossSpawn = require('cross-spawn');

var _crossSpawn2 = _interopRequireDefault(_crossSpawn);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var shouldIgnore = function shouldIgnore(value) {
  return value === 'ignore' || value === 'inherit';
};

var parseStdioOption = function parseStdioOption(value) {
  var ignoreStdout = false;
  var ignoreStderr = false;
  if (shouldIgnore(value)) {
    ignoreStdout = true;
    ignoreStderr = true;
  } else if (Array.isArray(value)) {
    ignoreStdout = shouldIgnore(value[1]);
    ignoreStderr = shouldIgnore(value[2]);
  }
  return [ignoreStdout, ignoreStderr];
};

exports.default = function (cmd, args) {
  var options = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];
  return new Promise(function (resolve, reject) {
    var proc = (0, _crossSpawn2.default)(cmd, args, options);
    var stdout = null;
    var stderr = null;

    var _parseStdioOption = parseStdioOption(options.stdio);

    var _parseStdioOption2 = _slicedToArray(_parseStdioOption, 2);

    var ignoreStdout = _parseStdioOption2[0];
    var ignoreStderr = _parseStdioOption2[1];

    if (!ignoreStdout) {
      stdout = [];
      proc.stdout.on('data', function (data) {
        stdout.push(data);
      });
    }
    if (!ignoreStderr) {
      stderr = [];
      proc.stderr.on('data', function (data) {
        stderr.push(data);
      });
    }
    proc.once('close', function (code) {
      if (code !== 0) {
        var err = new Error('Exited with status ' + code);
        err.exitStatus = code;
        if (!ignoreStderr) {
          err.stderr = Buffer.concat(stderr);
        }
        reject(err);
      } else {
        resolve(ignoreStdout ? null : Buffer.concat(stdout));
      }
    });
    proc.once('error', reject);
  });
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7OztBQUVBOzs7Ozs7QUFFQSxJQUFNLGVBQWUsU0FBZixZQUFlLENBQUMsS0FBRDtBQUFBLFNBQVksVUFBVSxRQUFWLElBQXNCLFVBQVUsU0FBNUM7QUFBQSxDQUFyQjs7QUFFQSxJQUFNLG1CQUFtQixTQUFuQixnQkFBbUIsQ0FBQyxLQUFELEVBQVc7QUFDbEMsTUFBSSxlQUFlLEtBQW5CO0FBQ0EsTUFBSSxlQUFlLEtBQW5CO0FBQ0EsTUFBSSxhQUFhLEtBQWIsQ0FBSixFQUF5QjtBQUN2QixtQkFBZSxJQUFmO0FBQ0EsbUJBQWUsSUFBZjtBQUNELEdBSEQsTUFHTyxJQUFJLE1BQU0sT0FBTixDQUFjLEtBQWQsQ0FBSixFQUEwQjtBQUMvQixtQkFBZSxhQUFhLE1BQU0sQ0FBTixDQUFiLENBQWY7QUFDQSxtQkFBZSxhQUFhLE1BQU0sQ0FBTixDQUFiLENBQWY7QUFDRDtBQUNELFNBQU8sQ0FBQyxZQUFELEVBQWUsWUFBZixDQUFQO0FBQ0QsQ0FYRDs7a0JBYWUsVUFBQyxHQUFELEVBQU0sSUFBTjtBQUFBLE1BQVksT0FBWix5REFBc0IsRUFBdEI7QUFBQSxTQUE2QixJQUFJLE9BQUosQ0FBWSxVQUFDLE9BQUQsRUFBVSxNQUFWLEVBQXFCO0FBQzNFLFFBQU0sT0FBTywwQkFBVyxHQUFYLEVBQWdCLElBQWhCLEVBQXNCLE9BQXRCLENBQWI7QUFDQSxRQUFJLFNBQVMsSUFBYjtBQUNBLFFBQUksU0FBUyxJQUFiOztBQUgyRSw0QkFJdEMsaUJBQWlCLFFBQVEsS0FBekIsQ0FKc0M7O0FBQUE7O0FBQUEsUUFJcEUsWUFKb0U7QUFBQSxRQUl0RCxZQUpzRDs7QUFLM0UsUUFBSSxDQUFDLFlBQUwsRUFBbUI7QUFDakIsZUFBUyxFQUFUO0FBQ0EsV0FBSyxNQUFMLENBQVksRUFBWixDQUFlLE1BQWYsRUFBdUIsVUFBQyxJQUFELEVBQVU7QUFBRSxlQUFPLElBQVAsQ0FBWSxJQUFaO0FBQW1CLE9BQXREO0FBQ0Q7QUFDRCxRQUFJLENBQUMsWUFBTCxFQUFtQjtBQUNqQixlQUFTLEVBQVQ7QUFDQSxXQUFLLE1BQUwsQ0FBWSxFQUFaLENBQWUsTUFBZixFQUF1QixVQUFDLElBQUQsRUFBVTtBQUFFLGVBQU8sSUFBUCxDQUFZLElBQVo7QUFBbUIsT0FBdEQ7QUFDRDtBQUNELFNBQUssSUFBTCxDQUFVLE9BQVYsRUFBbUIsVUFBQyxJQUFELEVBQVU7QUFDM0IsVUFBSSxTQUFTLENBQWIsRUFBZ0I7QUFDZCxZQUFNLE1BQU0sSUFBSSxLQUFKLHlCQUFnQyxJQUFoQyxDQUFaO0FBQ0EsWUFBSSxVQUFKLEdBQWlCLElBQWpCO0FBQ0EsWUFBSSxDQUFDLFlBQUwsRUFBbUI7QUFDakIsY0FBSSxNQUFKLEdBQWEsT0FBTyxNQUFQLENBQWMsTUFBZCxDQUFiO0FBQ0Q7QUFDRCxlQUFPLEdBQVA7QUFDRCxPQVBELE1BT087QUFDTCxnQkFBUSxlQUFlLElBQWYsR0FBc0IsT0FBTyxNQUFQLENBQWMsTUFBZCxDQUE5QjtBQUNEO0FBQ0YsS0FYRDtBQVlBLFNBQUssSUFBTCxDQUFVLE9BQVYsRUFBbUIsTUFBbkI7QUFDRCxHQTFCMkMsQ0FBN0I7QUFBQSxDIiwiZmlsZSI6ImluZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnXHJcblxyXG5pbXBvcnQgY3Jvc3NTcGF3biBmcm9tICdjcm9zcy1zcGF3bidcclxuXHJcbmNvbnN0IHNob3VsZElnbm9yZSA9ICh2YWx1ZSkgPT4gKHZhbHVlID09PSAnaWdub3JlJyB8fCB2YWx1ZSA9PT0gJ2luaGVyaXQnKVxyXG5cclxuY29uc3QgcGFyc2VTdGRpb09wdGlvbiA9ICh2YWx1ZSkgPT4ge1xyXG4gIGxldCBpZ25vcmVTdGRvdXQgPSBmYWxzZVxyXG4gIGxldCBpZ25vcmVTdGRlcnIgPSBmYWxzZVxyXG4gIGlmIChzaG91bGRJZ25vcmUodmFsdWUpKSB7XHJcbiAgICBpZ25vcmVTdGRvdXQgPSB0cnVlXHJcbiAgICBpZ25vcmVTdGRlcnIgPSB0cnVlXHJcbiAgfSBlbHNlIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xyXG4gICAgaWdub3JlU3Rkb3V0ID0gc2hvdWxkSWdub3JlKHZhbHVlWzFdKVxyXG4gICAgaWdub3JlU3RkZXJyID0gc2hvdWxkSWdub3JlKHZhbHVlWzJdKVxyXG4gIH1cclxuICByZXR1cm4gW2lnbm9yZVN0ZG91dCwgaWdub3JlU3RkZXJyXVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCAoY21kLCBhcmdzLCBvcHRpb25zID0ge30pID0+IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICBjb25zdCBwcm9jID0gY3Jvc3NTcGF3bihjbWQsIGFyZ3MsIG9wdGlvbnMpXHJcbiAgbGV0IHN0ZG91dCA9IG51bGxcclxuICBsZXQgc3RkZXJyID0gbnVsbFxyXG4gIGNvbnN0IFtpZ25vcmVTdGRvdXQsIGlnbm9yZVN0ZGVycl0gPSBwYXJzZVN0ZGlvT3B0aW9uKG9wdGlvbnMuc3RkaW8pXHJcbiAgaWYgKCFpZ25vcmVTdGRvdXQpIHtcclxuICAgIHN0ZG91dCA9IFtdXHJcbiAgICBwcm9jLnN0ZG91dC5vbignZGF0YScsIChkYXRhKSA9PiB7IHN0ZG91dC5wdXNoKGRhdGEpIH0pXHJcbiAgfVxyXG4gIGlmICghaWdub3JlU3RkZXJyKSB7XHJcbiAgICBzdGRlcnIgPSBbXVxyXG4gICAgcHJvYy5zdGRlcnIub24oJ2RhdGEnLCAoZGF0YSkgPT4geyBzdGRlcnIucHVzaChkYXRhKSB9KVxyXG4gIH1cclxuICBwcm9jLm9uY2UoJ2Nsb3NlJywgKGNvZGUpID0+IHtcclxuICAgIGlmIChjb2RlICE9PSAwKSB7XHJcbiAgICAgIGNvbnN0IGVyciA9IG5ldyBFcnJvcihgRXhpdGVkIHdpdGggc3RhdHVzICR7Y29kZX1gKVxyXG4gICAgICBlcnIuZXhpdFN0YXR1cyA9IGNvZGVcclxuICAgICAgaWYgKCFpZ25vcmVTdGRlcnIpIHtcclxuICAgICAgICBlcnIuc3RkZXJyID0gQnVmZmVyLmNvbmNhdChzdGRlcnIpXHJcbiAgICAgIH1cclxuICAgICAgcmVqZWN0KGVycilcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJlc29sdmUoaWdub3JlU3Rkb3V0ID8gbnVsbCA6IEJ1ZmZlci5jb25jYXQoc3Rkb3V0KSlcclxuICAgIH1cclxuICB9KVxyXG4gIHByb2Mub25jZSgnZXJyb3InLCByZWplY3QpXHJcbn0pXHJcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
